# Тестирование функциональности блокировки пользователей при логине

## Что было реализовано

### 1. Улучшенная обработка ошибок при логине
- В файле `src/users/components/LoginForm.jsx` добавлена специфичная обработка ошибок
- Теперь показываются разные сообщения в зависимости от типа ошибки:
  - Блокировка пользователя: "Пользователь заблокирован. Обратитесь к администратору."
  - Неверные данные: "Неверный email или пароль"
  - Общая ошибка: "Ошибка входа в систему"

### 2. Использование современного UI для уведомлений
- Заменены `alert()` на красивые уведомления через `useSnack`
- Добавлено уведомление об успешном входе

### 3. Глобальная обработка блокировки
- Создан axios interceptor (`src/services/axiosInterceptor.js`)
- Автоматически обрабатывает случаи, когда пользователь блокируется во время активной сессии
- При обнаружении блокировки автоматически:
  - Удаляет токен из localStorage
  - Перенаправляет на страницу логина
  - Показывает уведомление о блокировке

## Как протестировать

### Сценарий 1: Блокировка при логине
1. Откройте админ-панель (http://localhost:5174/admin/users)
2. Авторизуйтесь как администратор
3. Найдите тестового пользователя
4. Нажмите кнопку "Block" для блокировки
5. Выйдите из системы
6. Попробуйте войти под заблокированным пользователем
7. **Ожидаемый результат**: Появится красное уведомление "Пользователь заблокирован. Обратитесь к администратору."

### Сценарий 2: Блокировка во время активной сессии
1. Войдите под тестовым пользователем
2. В другой вкладке или браузере войдите как администратор
3. Заблокируйте того же пользователя в админ-панели
4. Вернитесь к первой вкладке с заблокированным пользователем
5. Попробуйте выполнить любое действие (переход по страницам, API запросы)
6. **Ожидаемый результат**: Пользователь будет автоматически разлогинен и перенаправлен на страницу логина

### Сценарий 3: Разблокировка
1. Разблокируйте пользователя в админ-панели (кнопка "Unblock")
2. Пользователь снова сможет входить в систему

## Файлы, которые были изменены

1. **src/users/components/LoginForm.jsx**
   - Улучшенная обработка ошибок при логине
   - Использование уведомлений вместо alert

2. **src/services/axiosInterceptor.js** (новый файл)
   - Глобальная обработка ошибок блокировки
   - Автоматический logout при блокировке

3. **src/App.jsx**
   - Подключение axios interceptor

4. **src/users/providers/UserProvider.jsx**
   - Добавлен импорт removeToken

## Техническая информация

### Обработка ошибок сервера
Система ожидает следующие типы ответов от сервера:

```json
// При блокировке пользователя
{
  "error": {
    "message": "User is blocked" // или содержит "blocked"/"заблокирован"
  }
}

// При неверных данных логина
{
  "error": {
    "message": "Invalid email or password"
  }
}
```

### HTTP статус коды
- **403** - Запрещено (используется для блокированных пользователей)
- **401** - Неавторизован (неверные данные или недействительный токен)
- **400** - Неверный запрос

## Дополнительные улучшения

Для более полной функциональности можно добавить:

1. **Периодическая проверка статуса** - каждые 5-10 минут проверять, не заблокирован ли пользователь
2. **WebSocket уведомления** - мгновенное уведомление о блокировке
3. **Логирование действий** - запись в логи всех попыток входа заблокированных пользователей
4. **Время блокировки** - показывать дату и время блокировки
5. **Причина блокировки** - поле для указания причины блокировки администратором

## Безопасность

- Токены автоматически удаляются при блокировке
- Система не позволяет заблокированным пользователям выполнять действия
- Все проверки дублируются на backend для безопасности
